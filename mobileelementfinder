#for one file
mefinder find -c ./WMW942_plasmid_AD443.fasta WMW942_plasmid_AD443 --blastn-path /mnt/storage7/woranich/ncbi-blast-2.16.0+/bin/blastn

#To do the loop
#!/bin/bash

# Define the path to blastn executable
BLASTN_PATH="/mnt/storage7/woranich/ncbi-blast-2.16.0+/bin/blastn"

# Check if the output directory exists, if not, create it
OUTPUT_DIR="kp_asia_asm"
mkdir -p "$OUTPUT_DIR"

# Loop through each .fasta file in the current directory
for file in *.fasta; do
    # Extract the base name without extension
    base_name=$(basename "$file" .fasta)

    # Run mefinder command
    mefinder find -c "$file" "$OUTPUT_DIR/$base_name" --blastn-path "$BLASTN_PATH"
done

echo "All files have been processed."

##To extract the results of mge

#!/bin/bash

# Output file for the summary
output_file="mge_summary.csv"

# Clear the output file if it exists
> "$output_file"

# Loop through each CSV file in the current directory
for file in *.csv; do
    # Extract plasmid ID from the filename
    plasmid_id=$(basename "$file" | sed -E 's/.*_(.*)\.csv/\1/')

    # Print header for the summary file
    echo "Plasmid ID, MGE Name, Identity, Coverage" >> "$output_file"

    # Read the CSV file and extract relevant columns
    while IFS=, read -r mge_no name synonyms prediction type allele_len depth e_value identity coverage gaps substitution contig start end cigar; do
        # Skip the header row
        if [[ "$name" != "name" ]]; then
            echo "$plasmid_id, $name, $identity, $coverage" >> "$output_file"
        fi
    done < "$file"
done

echo "Summary of MGEs has been written to $output_file."
